<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>HogwartsBot scoreboard</title>
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-109160129-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());
		gtag('config', 'UA-109160129-1');
	</script>
	<script src="/socket.io/socket.io.js"></script>
	<style>
		* {
			margin: 0;
			padding: 0;
		}
		body {
			background: #232323;
			
		}
		#rezultati {
			width: 100%;
			display: -webkit-box;
			display: -moz-box;
			display: -ms-flexbox;
			display: -webkit-flex;
			display: flex;
			justify-content: center;
		}
		.dom {
			width: 23%;
			min-width: 130px;
			max-width: 200px;

			margin-left: 2px;
			margin-right: 2px;

			min-height: 350px;

			float: left;
			position: relative;
			color: white;
			transition: all 1s;
		}
		#gryffindor:after,
		#ravenclaw:after,
		#slytherin:after,
		#hufflepuff:after {
			content: "";
			position: absolute;
			bottom: -60px;
			left: 0;
			width: 100%;
			height: 100px;
			background-repeat: no-repeat;
			background-position: bottom center;
		}
		#gryffindor {
			background: #a70c0c;
		}
		#ravenclaw {
			background: #049dc6;
		}
		#slytherin {
			background: #2aaa4a;
		}
		#hufflepuff {
			background: #ebcf19;
		}
		#gryffindor:after {
			background-image: url('slike/rds.png');
		}
		#ravenclaw:after {
			background-image: url('slike/mos.png');
		}
		#slytherin:after {
			background-image: url('slike/zes.png');
		}
		#hufflepuff:after {
			background-image: url('slike/rus.png');
		}
		.dom .logo img {
			width: 80%;
			display: block;
			margin: 40px auto 10px;
		}
		.dom .ime {
			font-weight: bold;
			font-family: Arial;
			text-align: center;
			font-size: 24px;
		}
		.dom .tocke {
			font-weight: bold;
			font-family: Arial;
			text-align: center;
			font-size: 46px;
			margin-top: 10px;
		}
		.komentar {
			background: white;
			width: 200px;
			font-size: 16px;
			font-family: 'Arial';
			line-height: 20px;
			padding: 4px;
			position: absolute;
		}
		.komentar .avtor {
			font-weight: bold;
			font-size: 16px;
			color: #369;
			margin-left: 4px;
			margin-right: 6px;
		}
	</style>
</head>
<body>
	<div id="rezultati">

		<div class="dom" id="gryffindor">
			<div class="logo"><img src="/slike/gryffindor.png"></div>
			<div class="ime">Gryffindor</div>
			<div class="tocke">0</div>
		</div>

		<div class="dom" id="ravenclaw">
			<div class="logo"><img src="/slike/ravenclaw.png"></div>
			<div class="ime">Ravenclaw</div>
			<div class="tocke">0</div>
		</div>

		<div class="dom" id="slytherin">
			<div class="logo"><img src="/slike/slytherin.png"></div>
			<div class="ime">Slytherin</div>
			<div class="tocke">0</div>
		</div>

		<div class="dom" id="hufflepuff">
			<div class="logo"><img src="/slike/hufflepuff.png"></div>
			<div class="ime">Hufflepuff</div>
			<div class="tocke">0</div>
		</div>
		
	</div>
	<script>
		var socket = io();

		function getPageHeight() {
			var w = window, d = document, e = d.documentElement, g = d.getElementsByTagName('body')[0];
			return w.innerHeight|| e.clientHeight|| g.clientHeight;
		}

		function getPageWidth() {
			var w = window, d = document, e = d.documentElement, g = d.getElementsByTagName('body')[0];
			return w.innerWidth || e.clientWidth || g.clientWidth;
		}

		function nastaviTocke(dom, tocke, podatki) {
			var oldRange = podatki.max - podatki.min;
			var pageHeight = getPageHeight() - 350 - 100;
			var domElement = document.getElementById(dom);
			domElement.children[2].innerText = tocke;
			domElement.style.height = (((tocke - podatki.min) / oldRange) * pageHeight + 350) + "px";
		}

		function prikaziDomove(domovi) {
			var najmanjse = Math.min(domovi["gryffindor"], domovi["ravenclaw"], domovi["slytherin"], domovi["hufflepuff"]);
			var najvecje = Math.max(domovi["gryffindor"], domovi["ravenclaw"], domovi["slytherin"], domovi["hufflepuff"]);
			var podatki = {"min": najmanjse, "max": najvecje};
			for (var imeDoma in domovi) {
				if (domovi.hasOwnProperty(imeDoma)) {
					nastaviTocke(imeDoma, domovi[imeDoma], podatki);
				}
			}
		}

		function Sporocilo(uporabnik, besedilo) {
			this.uporabnik = uporabnik;
			this.besedilo = besedilo;
			this.element = document.createElement("div");
			this.element.className = "komentar";
			
			var randomAngle = Math.pow(-1, Math.floor(Math.random() * 2)) * Math.floor(Math.random() * 30);
			var randomX = Math.floor(Math.random() * (getPageWidth() - 210));
			var randomY = Math.floor(Math.random() * (getPageHeight() - 100));
			this.element.style.transform = "rotate("+randomAngle+"deg)";
			this.element.style.top = randomY + "px";
			this.element.style.left = randomX + "px";
			this.element.innerHTML = '<span class="avtor">' + this.uporabnik + '</span>' + this.besedilo;
			document.body.appendChild(this.element);
			
			this.remove = function() {
				this.element.parentElement.removeChild(this.element);
			}
			var _this = this;
			setTimeout(function() { _this.remove(); }, 5000);	
		}

		socket.on("podatki", function(domovi) {
			prikaziDomove(domovi);
		});

		socket.on("sporocilo", function(podatki) {
			console.log(podatki);
			for (var i = 0; i < podatki.length; i++) {
				new Sporocilo(podatki[i].uporabnik, podatki[i].besedilo);
			}
		});
	</script>
</body>
</html>